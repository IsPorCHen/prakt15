<Page x:Class="ElectronicsShop.Pages.CatalogPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="Каталог товаров"
      Loaded="Page_Loaded">
    <Grid Margin="{StaticResource SmallMargin}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                    Style="{StaticResource FilterPanelStyle}">
            <DockPanel>
                <TextBlock Text="Каталог товаров" 
                           Style="{StaticResource HeaderTextStyle}"
                           DockPanel.Dock="Left"/>
                <Button Content="Управление данными" 
                        Click="ManageData_Click"
                        Visibility="{Binding ManagerButtonsVisibility}"
                        DockPanel.Dock="Right"
                        Margin="{StaticResource StandardMargin}"/>
            </DockPanel>

            <TextBlock Text="Поиск" 
                       Style="{StaticResource SubHeaderTextStyle}"/>
            <TextBox Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="Введите название товара"
                     TextChanged="SearchBox_TextChanged"/>
        </StackPanel>

        <!-- Панель фильтрации и сортировки -->
        <ScrollViewer Grid.Row="1" Grid.Column="0" 
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Style="{StaticResource FilterPanelStyle}">

                <TextBlock Text="Сортировка" 
                           Style="{StaticResource SubHeaderTextStyle}"/>
                <ComboBox x:Name="SortComboBox"
                          SelectionChanged="SortComboBox_SelectionChanged"
                          Margin="{StaticResource StandardMargin}">
                    <ComboBoxItem Content="По наименованию" Tag="Name"/>
                    <ComboBoxItem Content="По цене (возрастание)" Tag="PriceAsc"/>
                    <ComboBoxItem Content="По цене (убывание)" Tag="PriceDesc"/>
                    <ComboBoxItem Content="По количеству (возрастание)" Tag="QuantityAsc"/>
                    <ComboBoxItem Content="По количеству (убывание)" Tag="QuantityDesc"/>
                </ComboBox>

                <TextBlock Text="Фильтр по категории" 
                           Style="{StaticResource SubHeaderTextStyle}"
                           Margin="5,15,5,5"/>
                <ComboBox x:Name="CategoryFilterComboBox"
                      ItemsSource="{Binding Categories}"
                      SelectedValuePath="Id"
                      SelectionChanged="FilterComboBox_SelectionChanged"
                      Margin="{StaticResource StandardMargin}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Text="Фильтр по бренду" 
                           Style="{StaticResource SubHeaderTextStyle}"
                           Margin="5,15,5,5"/>

                <ComboBox x:Name="BrandFilterComboBox"
          ItemsSource="{Binding Brands}"
          SelectedValuePath="Id"
          SelectionChanged="FilterComboBox_SelectionChanged"
          Margin="{StaticResource StandardMargin}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Text="Фильтр по цене" 
                           Style="{StaticResource SubHeaderTextStyle}"
                           Margin="5,15,5,5"/>
                <Label Content="от" Margin="5,5,5,0"/>
                <TextBox Text="{Binding PriceFrom, UpdateSourceTrigger=PropertyChanged}"
                         materialDesign:HintAssist.Hint="Минимальная цена"
                         TextChanged="FilterTextBox_TextChanged"
                         PreviewTextInput="NumberValidation_PreviewTextInput"/>

                <Label Content="до" Margin="5,5,5,0"/>
                <TextBox Text="{Binding PriceTo, UpdateSourceTrigger=PropertyChanged}"
                         materialDesign:HintAssist.Hint="Максимальная цена"
                         TextChanged="FilterTextBox_TextChanged"
                         PreviewTextInput="NumberValidation_PreviewTextInput"/>

                <Button Content="Сбросить фильтры"
                        Click="ResetFilters_Click"
                        Margin="5,20,5,5"/>
            </StackPanel>
        </ScrollViewer>

        <materialDesign:ColorZone Grid.Row="1" Grid.Column="1"
                                  Mode="Light"
                                  Padding="{StaticResource SmallPadding}">
            <ListView x:Name="ProductsListView"
                      ItemsSource="{Binding ProductsView}"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource ProductCardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" 
                                            Margin="{StaticResource SmallMargin}">
                                    <TextBlock Text="{Binding DisplayName}" 
                                               FontSize="16" 
                                               FontWeight="Bold"
                                               TextWrapping="Wrap"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>

                                    <TextBlock Text="{Binding Category.Name}" 
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,2,0,0"/>

                                    <TextBlock Text="{Binding Description}" 
                                               TextWrapping="Wrap"
                                               Margin="0,5,0,0"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" 
                                            VerticalAlignment="Center"
                                            Margin="{StaticResource StandardMargin}">
                                    <TextBlock Text="{Binding PriceFormatted}" 
                                               FontSize="18" 
                                               FontWeight="Bold"
                                               HorizontalAlignment="Right"
                                               Foreground="{StaticResource PrimaryAccentBrush}"/>

                                    <TextBlock Text="{Binding QuantityText}" 
                                               FontSize="12"
                                               HorizontalAlignment="Right"
                                               Margin="0,5,0,0"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </materialDesign:ColorZone>

        <WrapPanel Grid.Row="2" Grid.ColumnSpan="2"
                   Background="White"
                   Margin="{StaticResource SmallMargin}">
            <!--Padding="{StaticResource StandardPadding}">-->
            <TextBlock Text="{Binding Products.Count, StringFormat='Всего товаров: {0}'}"
                       Margin="{StaticResource StandardMargin}"
                       FontWeight="SemiBold"/>
            <TextBlock Text="{Binding ElementName=ProductsListView, Path=Items.Count, StringFormat='Показано: {0}'}"
                       Margin="{StaticResource StandardMargin}"
                       FontWeight="SemiBold"/>
        </WrapPanel>
    </Grid>
</Page>